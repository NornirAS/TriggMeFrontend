<div *ngIf="!token">
  <p>User: <input type="text" [(ngModel)]="username"></p>
  <p>Pass: <input type="password" [(ngModel)]="password" (keyup.enter)="login()"></p>
  <p><button (click)="login()">Login</button><span> {{error}}</span></p>
</div>
<div *ngIf="token">
  <table>
    <tr>
      <td>Rabatt %</td>
      <td><input type="number" [(ngModel)]="triggmebody.discount_level" (change)="getBuckets()"></td>
    </tr>
    <tr>
      <td>Gjennomsnitt antall handler</td>
      <td class="green">{{triggmebody.average_purchase_count}}</td>
    </tr>
    <tr>
      <td>Innkjøpspris %</td>
      <td><input type="number" [(ngModel)]="triggmebody.innkjopspris_prosent" (change)="getBuckets()"></td>
    </tr>
    <tr>
      <td>Test kjøpesum</td>
      <td><input type="number" [(ngModel)]="triggmebody.average_purchase" (change)="getBuckets()"></td>
    </tr>
    <tr>
      <td>Triggme avgift % </td>
      <td><input type="number" [(ngModel)]="triggmebody.humaniter_fee_prosent"></td>
    </tr>
    <tr>
      <td>Humanitær %</td>
      <td><input type="number" [(ngModel)]="triggmebody.triggme_fee_prosent"></td>
    </tr>
    <tr>
      <td>Totalomsetning</td>
      <td class="green">{{triggmebody.total_purchase}}</td>
    </tr>
  </table>
  <table>
    <tr>
      <td>Kjøpsbeløp ved tilgodelapp</td>
      <td class="green" *ngFor="let item of triggmebody.trigg_purchase"> {{item}} </td>
    </tr>
    <tr>
      <td>Tilgodelapp beløp</td>
      <td class="green" *ngFor="let item of triggmebody.tilgodelapp"> {{item}} </td>
    </tr>
    <tr>
      <td>Triggme avgift beløp</td>
      <td class="green" *ngFor="let item of triggmebody.triggme_avgift"> {{item}} </td>
    </tr>
    <tr>
      <td>Humanitært beløp</td>
      <td class="green" *ngFor="let item of triggmebody.humaniter_andel"> {{item}} </td>
    </tr>
    <tr>
      <td>Kostnad </td>
      <td class="green" *ngFor="let item of triggmebody.last_cost"> {{item}} </td>
    </tr>
    <tr>
      <td>QRCode</td>
      <td class="green" *ngFor="let item of triggmebody.qrcode"> <img *ngIf="triggmebody.qrcode.length>0" [src]="item">
      </td>
    </tr>
  </table>
  <p><button (click)="getBuckets()">Lag bøtter</button></p>
  <p><button (click)="simulatePurchase()">Simuler </button><input type="number" [(ngModel)]="simulate_count"
      class="smal"> kjøp<span>{{teller}}</span></p>
  <img *ngIf="showImage" src="{{qrCode}}" />
  <button (click)="showBuckets=!showBuckets">Vis bøtter</button>
  <table *ngIf="showBuckets">
    <!-- <th *ngFor="let item of bucketInput[0] | keyvalue" >{{item.key}}</th> -->
    <tr>
      <td>Id</td>
      <td>Nr</td>
      <td>Count</td>
      <td>Siste kjøpsbeløp</td>
      <td>triggSaldo</td>
      <td>Siste rabattbeløp</td>
      <td>TriggFee</td>
      <td>Humanitarian</td>
    </tr>
    <ng-container *ngFor="let bucket of bucketInput">
      <tr
        *ngIf="triggmebody.average_purchase<minimumBucketAmount || (triggmebody.average_purchase>=bucket.purchaseLimitLow && triggmebody.average_purchase<=bucket.purchaseLimitHigh)">
        <td>{{bucket.bucketId}}</td>
        <td>{{bucket.bucketNr}}</td>
        <td [ngClass]="{'veryhot':bucket.lastPurchaseHot , 'verynormal': !bucket.lastPurchaseHot }">{{bucket.buyCount}}
        </td>
        <td [ngClass]="{'hot':bucket.lastPurchaseHot , 'normal': !bucket.lastPurchaseHot }">{{bucket.lastPurchase}}</td>
        <td [ngClass]="{'hot':bucket.triggSaldoHot , 'normal': !bucket.triggSaldoHot }">{{bucket.triggSaldo}}</td>
        <td [ngClass]="{'hot':bucket.triggSaldoHot , 'normal': !bucket.triggSaldoHot }">{{bucket.lastDiscountAmount}}
        </td>
        <td [ngClass]="{'trigg':bucket.humanitarianValueHot , 'triggnormal': !bucket.humanitarianValueHot }">
          {{bucket.triggMeFeeValue}}</td>
        <td [ngClass]="{'trigg':bucket.humanitarianValueHot , 'triggnormal': !bucket.humanitarianValueHot }">
          {{bucket.humanitarianValue}}</td>
      </tr>
    </ng-container>
  </table>
</div>