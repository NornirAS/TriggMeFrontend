<div *ngIf="!token">
  <p>User: <input type="text" [(ngModel)]="username"></p>
  <p>Pass: <input type="password" [(ngModel)]="password" (keyup.enter)="login()"></p>
  <p><button (click)="login()">Login</button><span> {{error}}</span></p>
</div>

<div *ngIf="token">
  <p><button (click)="token=null">Logut</button></p>
  <table>
    <tr>
      <td>Valuta</td>
      <td>
        <select id="currency" [(ngModel)]="triggmebody.currency" (ngModelChange)="currencyChange()">
          <option *ngFor="let valuta of currencySymbols; let i=index;" [value]="valuta">{{
            currencyNames[i] }}</option>
        </select>
      </td>
      <td rowspan="4"><img src='{{"assets/"+triggmebody.currency+".png"}}'/></td>
    </tr>
    <tr>
      <td>Rabatt %</td>
      <td><input type="number" [(ngModel)]="triggmebody.discount_level" (change)="getBuckets()"></td>
    </tr>
    <tr>
      <td>Gjennomsnitt antall handler</td>
      <td class="green">{{triggmebody.average_purchase_count}}</td>
    </tr>
    <tr>
      <td>Innkjøpspris %</td>
      <td><input type="number" [(ngModel)]="triggmebody.innkjopspris_prosent" (change)="getBuckets()"></td>
    </tr>
    <tr>
      <td>Test kjøpesum</td>
      <td><input type="number" data-type="currency" [(ngModel)]="triggmebody.average_purchase" (change)="getBuckets()"></td>
    </tr>
    <tr>
      <td>Triggme avgift % </td>
      <td><input type="number" [(ngModel)]="triggmebody.humaniter_fee_prosent"></td>
    </tr>
    <tr>
      <td>Humanitær %</td>
      <td><input type="number" [(ngModel)]="triggmebody.triggme_fee_prosent"></td>
    </tr>
    <tr>
      <td><button (click)="simulatePurchase()">Simuler kjøp</button><input type="number" [(ngModel)]="simulate_count"
          class="smal"> </td>
      <td>
        <div class="progress-container">
          <div class="progress-bar" [ngStyle]="{'width.%':count_percent}"></div>
          <div class="progress-text">{{teller}}</div>
        </div>
      </td>
    </tr>
    <tr>
      <td>Totalomsetning</td>
      <td class="green">{{triggmebody.currency}} {{triggmebody.total_purchase | number:'1.2-2'}}</td>
    </tr>
    <tr>
      <td>Total triggfee</td>
      <td class="green">{{triggmebody.currency}}{{triggmebody.total_acc_trigg_fee| number:'1.2-2'}}</td>
    </tr>
    <tr>
      <td>Total humanitær</td>
      <td class="green">{{triggmebody.currency}}{{triggmebody.total_acc_humanitarian| number:'1.2-2'}}</td>
    </tr>
  </table>
  <table>
    <tr>
      <td>Kjøpsbeløp ved tilgodelapp</td>
      <td class="green" *ngFor="let item of triggmebody.trigg_purchase">{{triggmebody.currency}} {{item| number:'1.2-2'}} </td>
    </tr>
    <tr>
      <td>Tilgodelapp beløp</td>
      <td class="green" *ngFor="let item of triggmebody.tilgodelapp">{{triggmebody.currency}} {{item| number:'1.2-2'}} </td>
    </tr>
    <tr>
      <td>Triggme avgift beløp</td>
      <td class="green" *ngFor="let item of triggmebody.triggme_avgift">{{triggmebody.currency}} {{item| number:'1.2-2'}} </td>
    </tr>
    <tr>
      <td>Humanitært beløp</td>
      <td class="green" *ngFor="let item of triggmebody.humaniter_andel">{{triggmebody.currency}} {{item| number:'1.2-2'}} </td>
    </tr>
    <tr>
      <td>Kostnad </td>
      <td class="green" *ngFor="let item of triggmebody.last_cost">{{triggmebody.currency}} {{item| number:'1.2-2'}} </td>
    </tr>
    <tr>
      <td>Total kjøp</td>
      <td class="green" *ngFor="let item of triggmebody.trigg_total_purchase">{{triggmebody.currency}} {{item| number:'1.2-2'}} </td>
    </tr>
    <tr>
      <td>QRCode</td>
      <td class="green" *ngFor="let item of triggmebody.qrcode"> <img *ngIf="triggmebody.qrcode.length>0" [src]="item">
      </td>
    </tr>
  </table>
  <p><button (click)="getBuckets()">Lag bøtter</button></p>
  <img *ngIf="showImage" src="{{qrCode}}" class="qrcode"/>
  <button (click)="showBuckets=!showBuckets">Vis bøtter</button>
  <table *ngIf="showBuckets">
    <!-- <th *ngFor="let item of bucketInput[0] | keyvalue" >{{item.key}}</th> -->
    <tr>
      <td>Id</td>
      <td>Nr</td>
      <td>Count</td>
      <td>Siste kjøpsbeløp</td>
      <td class="trigg_saldo">triggSaldo</td>
      <td>Siste rabattbeløp</td>
      <td>TriggFee</td>
      <td>Humanitarian</td>
      <td>sum TriggFee</td>
      <td>sum Humanitarian</td>
    </tr>
    <ng-container *ngFor="let bucket of bucketInput">
      <tr
        *ngIf="triggmebody.average_purchase<minimumBucketAmount || (triggmebody.average_purchase>=bucket.purchaseLimitLow && triggmebody.average_purchase<=bucket.purchaseLimitHigh)">
        <td>{{bucket.bucketId}}</td>
        <td>{{bucket.bucketNr}}</td>
        <td [ngClass]="{'veryhot':bucket.lastPurchaseHot , 'verynormal': !bucket.lastPurchaseHot }">{{bucket.buyCount}}
        </td>
        <td [ngClass]="{'hot':bucket.lastPurchaseHot , 'normal': !bucket.lastPurchaseHot }">{{triggmebody.currency}} {{bucket.lastPurchase| number:'1.2-2'}}</td>
        <td>
          <div class="progress-container">
            <div class="progress-bar" [ngStyle]="{'width.%':bucket.progress}"></div>
            <div class="progress-text">{{triggmebody.currency}} {{bucket.triggSaldo| number:'1.2-2'}}</div>
          </div>
        </td>
        <td [ngClass]="{'hot':bucket.triggSaldoHot , 'normal': !bucket.triggSaldoHot }">{{triggmebody.currency}} {{bucket.lastDiscountAmount| number:'1.2-2'}}
        </td>
        <td [ngClass]="{'trigg':bucket.humanitarianValueHot , 'triggnormal': !bucket.humanitarianValueHot }">
          {{triggmebody.currency}} {{bucket.triggMeFeeValue| number:'1.2-2'}}</td>
        <td [ngClass]="{'trigg':bucket.humanitarianValueHot , 'triggnormal': !bucket.humanitarianValueHot }">
          {{triggmebody.currency}} {{bucket.humanitarianValue| number:'1.2-2'}}</td>
        <td [ngClass]="{'trigg':bucket.humanitarianValueHot , 'triggnormal': !bucket.humanitarianValueHot }">
          {{triggmebody.currency}} {{bucket.accTriggFee| number:'1.2-2'}}</td>
        <td [ngClass]="{'trigg':bucket.humanitarianValueHot , 'triggnormal': !bucket.humanitarianValueHot }">
          {{triggmebody.currency}} {{bucket.accHumanitarian| number:'1.2-2'}}</td>
      </tr>
    </ng-container>
  </table>
</div>